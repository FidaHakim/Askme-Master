<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Askme v121.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://js.puter.com/v2/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Google Sans', sans-serif; background: #f8fafd; color: #1f1f1f; height: 100dvh; margin: 0; display: flex; flex-direction: column; overflow: hidden; position: fixed; width: 100%; }
        
        /* Header */
        header { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 16px; background: #f8fafd; z-index: 50; flex-shrink: 0; }
        .mode-badge { font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.5px; }
        .mode-online { background: #e8f0fe; color: #0b57d0; }
        .mode-offline { background: #fee8e8; color: #d00b0b; }

        /* Profile Pic Styling */
        .profile-pic { width: 38px; height: 38px; border-radius: 50%; overflow: hidden; border: 1px solid #e3e3e3; background: white; display: flex; align-items: center; justify-content: center; }
        .profile-pic img { width: 100%; height: 100%; object-fit: cover; }

        /* Chat Area */
        #chat-window { flex: 1; overflow-y: auto; padding: 0 24px; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; }
        #chat-window::-webkit-scrollbar { display: none; }
        
        .hi-text { font-size: 28px; margin-top: 50px; color: #1f1f1f; background: linear-gradient(90deg, #d93025, #ea4335); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: inline-block; font-weight: 500; }
        .hero-main { font-size: 42px; line-height: 1.15; margin-bottom: 40px; color: #444746; letter-spacing: -1px; }

        /* Action Pills */
        .action-pill { background: white; border: 1px solid #e3e3e3; border-radius: 32px; padding: 14px 24px; display: flex; align-items: center; gap: 12px; width: fit-content; font-size: 16px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .action-pill:active { transform: scale(0.97); background: #f8f9fa; }

        /* Bottom UI */
        .bottom-nav { padding: 12px 16px 24px; background: white; border-top-left-radius: 32px; border-top-right-radius: 32px; flex-shrink: 0; box-shadow: 0 -4px 24px rgba(0,0,0,0.04); }
        .input-box { display: flex; flex-direction: column; gap: 12px; background: #f0f4f9; border-radius: 28px; padding: 16px 20px; transition: 0.3s; }
        #query { font-size: 18px; border: none; outline: none; background: transparent; width: 100%; color: #1f1f1f; font-family: 'Google Sans', sans-serif; }
        
        .tools-row { display: flex; align-items: center; justify-content: space-between; }
        .tools-left { display: flex; gap: 24px; color: #444746; font-size: 24px; }
        .tools-right { display: flex; align-items: center; gap: 12px; }
        .fast-btn { border: 1px solid #c4c7c5; background: white; border-radius: 20px; padding: 5px 14px; font-size: 13px; font-weight: 500; color: #444746; }
        
        .circle-btn { width: 42px; height: 42px; border-radius: 50%; background: #fff; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 2px rgba(0,0,0,0.1); cursor: pointer; transition: 0.3s; }
        .mic-active { background: #fee8e8 !important; color: #d93025 !important; animation: pulse 1.5s infinite; }
        .spark-send { background: linear-gradient(135deg, #f0f4f9 0%, #e8f0fe 100%); color: #0b57d0; box-shadow: none; border: 1px solid #e3e3e3; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(217, 48, 37, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(217, 48, 37, 0); } 100% { box-shadow: 0 0 0 0 rgba(217, 48, 37, 0); } }

        /* Sidebar & Switch */
        #sidebar { position: fixed; left: -320px; top: 0; bottom: 0; width: 300px; background: white; z-index: 1000; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); padding: 24px; box-shadow: 10px 0 40px rgba(0,0,0,0.1); }
        #sidebar.open { left: 0; }
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 900; backdrop-filter: blur(2px); }
        
        .switch-container { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: #f0f4f9; border-radius: 20px; margin-bottom: 24px; }
        .switch { position: relative; width: 48px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background: #ccc; transition: .3s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background: white; transition: .3s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background: #0b57d0; }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Messages */
        .msg-u { align-self: flex-end; background: #f0f4f9; padding: 14px 22px; border-radius: 24px; border-bottom-right-radius: 4px; margin-bottom: 24px; max-width: 85%; margin-left: auto; font-size: 16px; color: #1f1f1f; }
        .msg-ai { display: flex; gap: 14px; margin-bottom: 32px; line-height: 1.6; font-size: 16px; color: #333; }
        .ai-icon { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #d93025, #ea4335); flex-shrink: 0; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:10px; }
        
        .country-card { background: #f8fafd; border: 1px solid #e3e3e3; padding: 16px; border-radius: 16px; margin-top: 8px; }
        .time-display { font-size: 32px; font-weight: 500; color: #1f1f1f; margin: 10px 0; }
    </style>
</head>
<body>

<div id="overlay" class="overlay" onclick="App.toggleMenu()"></div>

<aside id="sidebar">
    <div onclick="location.reload()" class="p-4 bg-[#e8f0fe] text-[#0b57d0] rounded-2xl text-center font-medium mb-8 cursor-pointer active:scale-95 transition shadow-sm">Ôºã New Chat</div>
    
    <div class="switch-container">
        <div>
            <div class="text-sm font-bold text-gray-800">Cloud Intelligence</div>
            <div class="text-xs text-gray-500">Toggle for Offline Mode</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="mode-toggle" checked onchange="App.updateMode()">
            <span class="slider"></span>
        </label>
    </div>

    <div class="space-y-6 text-[15px] font-medium text-gray-600 pl-2">
        <div class="flex items-center gap-3">üåç 210+ Countries (Active)</div>
        <div class="flex items-center gap-3">üìê Math Engine (Offline)</div>
        <div class="flex items-center gap-3">üìÖ Time & Date Core</div>
        <div onclick="App.sync()" class="flex items-center gap-3 text-blue-600 cursor-pointer pt-4 border-t">üîë Sync Profile</div>
    </div>
</aside>

<header>
    <button onclick="App.toggleMenu()" class="p-2 text-2xl text-[#444746]">‚ò∞</button>
    <div class="flex flex-col items-center">
        <span class="font-medium text-[22px] text-[#1f1f1f]">Askme</span>
        <span id="status-badge" class="mode-badge mode-online">Online</span>
    </div>
    <div onclick="App.sync()" class="profile-pic cursor-pointer">
        <img src="https://ui-avatars.com/api/?name=Ask+Me&background=d93025&color=fff&rounded=true" alt="Askme Logo" id="user-logo"> 
    </div>
</header>

<main id="chat-window">
    <div id="hero">
        <div class="hi-text">Hi Sir</div>
        <h1 class="hero-main">Where should we start?</h1>
        <div class="flex flex-col">
            <div onclick="App.fill('Generate image of future city')" class="action-pill">üçå Create image</div>
            <div onclick="App.fill('Time in New York')" class="action-pill">üìö Help me learn</div>
            <div onclick="App.fill('Tell me about Kiribati')" class="action-pill">‚ú® Boost my day</div>
            <div onclick="App.fill('Solve 50 * 120')" class="action-pill">üìÑ Write anything</div>
        </div>
    </div>
    <div id="messages" class="flex flex-col pt-6"></div>
</main>

<div class="bottom-nav">
    <div class="input-box">
        <input id="query" type="text" placeholder="Ask Askme" autocomplete="off">
        <div class="tools-row">
            <div class="tools-left">
                <button onclick="document.getElementById('f-in').click()" class="hover:bg-gray-200 rounded-full p-1 transition">Ôºã</button>
                <button class="hover:bg-gray-200 rounded-full p-1 transition">üî≥</button>
            </div>
            <div class="tools-right">
                <div class="fast-btn">Fast</div>
                <div id="mic-btn" onclick="App.startVoice()" class="circle-btn">üéôÔ∏è</div>
                <button id="send-trigger" class="circle-btn spark-send">‚ú®</button>
            </div>
        </div>
    </div>
    <input type="file" id="f-in" class="hidden">
</div>

<script>
// --- 210+ COUNTRIES & TIME LOGIC ---
const Atlas = {
    db: {
        "afghanistan": ["Kabul", "Asia", "AFN", 4.5], "albania": ["Tirana", "Europe", "ALL", 1], "algeria": ["Algiers", "Africa", "DZD", 1],
        "andorra": ["Andorra la Vella", "Europe", "EUR", 1], "angola": ["Luanda", "Africa", "AOA", 1], "argentina": ["Buenos Aires", "S. America", "ARS", -3],
        "armenia": ["Yerevan", "Asia", "AMD", 4], "australia": ["Canberra", "Oceania", "AUD", 10], "austria": ["Vienna", "Europe", "EUR", 1],
        "azerbaijan": ["Baku", "Asia", "AZN", 4], "bahamas": ["Nassau", "N. America", "BSD", -5], "bahrain": ["Manama", "Asia", "BHD", 3],
        "bangladesh": ["Dhaka", "Asia", "BDT", 6], "barbados": ["Bridgetown", "N. America", "BBD", -4], "belarus": ["Minsk", "Europe", "BYN", 3],
        "belgium": ["Brussels", "Europe", "EUR", 1], "belize": ["Belmopan", "N. America", "BZD", -6], "benin": ["Porto-Novo", "Africa", "XOF", 1],
        "bhutan": ["Thimphu", "Asia", "BTN", 6], "bolivia": ["Sucre", "S. America", "BOB", -4], "bosnia": ["Sarajevo", "Europe", "BAM", 1],
        "botswana": ["Gaborone", "Africa", "BWP", 2], "brazil": ["Brasilia", "S. America", "BRL", -3], "brunei": ["Bandar Seri Begawan", "Asia", "BND", 8],
        "bulgaria": ["Sofia", "Europe", "BGN", 2], "burkina faso": ["Ouagadougou", "Africa", "XOF", 0], "burundi": ["Gitega", "Africa", "BIF", 2],
        "cambodia": ["Phnom Penh", "Asia", "KHR", 7], "cameroon": ["Yaounde", "Africa", "XAF", 1], "canada": ["Ottawa", "N. America", "CAD", -5],
        "cape verde": ["Praia", "Africa", "CVE", -1], "chile": ["Santiago", "S. America", "CLP", -4], "china": ["Beijing", "Asia", "CNY", 8],
        "colombia": ["Bogota", "S. America", "COP", -5], "comoros": ["Moroni", "Africa", "KMF", 3], "congo": ["Brazzaville", "Africa", "XAF", 1],
        "costa rica": ["San Jose", "N. America", "CRC", -6], "croatia": ["Zagreb", "Europe", "EUR", 1], "cuba": ["Havana", "N. America", "CUP", -5],
        "cyprus": ["Nicosia", "Europe", "EUR", 2], "czechia": ["Prague", "Europe", "CZK", 1], "denmark": ["Copenhagen", "Europe", "DKK", 1],
        "djibouti": ["Djibouti", "Africa", "DJF", 3], "dominica": ["Roseau", "N. America", "XCD", -4], "ecuador": ["Quito", "S. America", "USD", -5],
        "egypt": ["Cairo", "Africa", "EGP", 2], "estonia": ["Tallinn", "Europe", "EUR", 2], "ethiopia": ["Addis Ababa", "Africa", "ETB", 3],
        "fiji": ["Suva", "Oceania", "FJD", 12], "finland": ["Helsinki", "Europe", "EUR", 2], "france": ["Paris", "Europe", "EUR", 1],
        "gabon": ["Libreville", "Africa", "XAF", 1], "gambia": ["Banjul", "Africa", "GMD", 0], "georgia": ["Tbilisi", "Asia", "GEL", 4],
        "germany": ["Berlin", "Europe", "EUR", 1], "ghana": ["Accra", "Africa", "GHS", 0], "greece": ["Athens", "Europe", "EUR", 2],
        "grenada": ["St. George's", "N. America", "XCD", -4], "guatemala": ["Guatemala City", "N. America", "GTQ", -6], "guinea": ["Conakry", "Africa", "GNF", 0],
        "guyana": ["Georgetown", "S. America", "GYD", -4], "haiti": ["Port-au-Prince", "N. America", "HTG", -5], "honduras": ["Tegucigalpa", "N. America", "HNL", -6],
        "hungary": ["Budapest", "Europe", "HUF", 1], "iceland": ["Reykjavik", "Europe", "ISK", 0], "india": ["New Delhi", "Asia", "INR", 5.5],
        "indonesia": ["Jakarta", "Asia", "IDR", 7], "iran": ["Tehran", "Asia", "IRR", 3.5], "iraq": ["Baghdad", "Asia", "IQD", 3],
        "ireland": ["Dublin", "Europe", "EUR", 0], "israel": ["Jerusalem", "Asia", "ILS", 2], "italy": ["Rome", "Europe", "EUR", 1],
        "jamaica": ["Kingston", "N. America", "JMD", -5], "japan": ["Tokyo", "Asia", "JPY", 9], "jordan": ["Amman", "Asia", "JOD", 3],
        "kazakhstan": ["Astana", "Asia", "KZT", 6], "kenya": ["Nairobi", "Africa", "KES", 3], "kiribati": ["South Tarawa", "Oceania", "AUD", 14],
        "kuwait": ["Kuwait City", "Asia", "KWD", 3], "kyrgyzstan": ["Bishkek", "Asia", "KGS", 6], "laos": ["Vientiane", "Asia", "LAK", 7],
        "latvia": ["Riga", "Europe", "EUR", 2], "lebanon": ["Beirut", "Asia", "LBP", 2], "lesotho": ["Maseru", "Africa", "LSL", 2],
        "liberia": ["Monrovia", "Africa", "LRD", 0], "libya": ["Tripoli", "Africa", "LYD", 2], "liechtenstein": ["Vaduz", "Europe", "CHF", 1],
        "lithuania": ["Vilnius", "Europe", "EUR", 2], "luxembourg": ["Luxembourg", "Europe", "EUR", 1], "madagascar": ["Antananarivo", "Africa", "MGA", 3],
        "malawi": ["Lilongwe", "Africa", "MWK", 2], "malaysia": ["Kuala Lumpur", "Asia", "MYR", 8], "maldives": ["Male", "Asia", "MVR", 5],
        "mali": ["Bamako", "Africa", "XOF", 0], "malta": ["Valletta", "Europe", "EUR", 1], "marshall islands": ["Majuro", "Oceania", "USD", 12],
        "mexico": ["Mexico City", "N. America", "MXN", -6], "micronesia": ["Palikir", "Oceania", "USD", 11], "moldova": ["Chisinau", "Europe", "MDL", 2],
        "monaco": ["Monaco", "Europe", "EUR", 1], "mongolia": ["Ulaanbaatar", "Asia", "MNT", 8], "montenegro": ["Podgorica", "Europe", "EUR", 1],
        "morocco": ["Rabat", "Africa", "MAD", 1], "mozambique": ["Maputo", "Africa", "MZN", 2], "myanmar": ["Naypyidaw", "Asia", "MMK", 6.5],
        "namibia": ["Windhoek", "Africa", "NAD", 2], "nauru": ["Yaren", "Oceania", "AUD", 12], "nepal": ["Kathmandu", "Asia", "NPR", 5.75],
        "netherlands": ["Amsterdam", "Europe", "EUR", 1], "new zealand": ["Wellington", "Oceania", "NZD", 12], "nicaragua": ["Managua", "N. America", "NIO", -6],
        "niger": ["Niamey", "Africa", "XOF", 1], "nigeria": ["Abuja", "Africa", "NGN", 1], "north korea": ["Pyongyang", "Asia", "KPW", 9],
        "norway": ["Oslo", "Europe", "NOK", 1], "oman": ["Muscat", "Asia", "OMR", 4], "pakistan": ["Islamabad", "Asia", "PKR", 5],
        "palau": ["Ngerulmud", "Oceania", "USD", 9], "panama": ["Panama City", "N. America", "PAB", -5], "papua new guinea": ["Port Moresby", "Oceania", "PGK", 10],
        "paraguay": ["Asuncion", "S. America", "PYG", -4], "peru": ["Lima", "S. America", "PEN", -5], "philippines": ["Manila", "Asia", "PHP", 8],
        "poland": ["Warsaw", "Europe", "PLN", 1], "portugal": ["Lisbon", "Europe", "EUR", 0], "qatar": ["Doha", "Asia", "QAR", 3],
        "romania": ["Bucharest", "Europe", "RON", 2], "russia": ["Moscow", "Europe", "RUB", 3], "rwanda": ["Kigali", "Africa", "RWF", 2],
        "saint lucia": ["Castries", "N. America", "XCD", -4], "samoa": ["Apia", "Oceania", "WST", 13], "san marino": ["San Marino", "Europe", "EUR", 1],
        "saudi arabia": ["Riyadh", "Asia", "SAR", 3], "senegal": ["Dakar", "Africa", "XOF", 0], "serbia": ["Belgrade", "Europe", "RSD", 1],
        "seychelles": ["Victoria", "Africa", "SCR", 4], "sierra leone": ["Freetown", "Africa", "SLE", 0], "singapore": ["Singapore", "Asia", "SGD", 8],
        "slovakia": ["Bratislava", "Europe", "EUR", 1], "slovenia": ["Ljubljana", "Europe", "EUR", 1], "solomon islands": ["Honiara", "Oceania", "SBD", 11],
        "somalia": ["Mogadishu", "Africa", "SOS", 3], "south africa": ["Pretoria", "Africa", "ZAR", 2], "south korea": ["Seoul", "Asia", "KRW", 9],
        "south sudan": ["Juba", "Africa", "SSP", 2], "spain": ["Madrid", "Europe", "EUR", 1], "sri lanka": ["Colombo", "Asia", "LKR", 5.5],
        "sudan": ["Khartoum", "Africa", "SDG", 2], "suriname": ["Paramaribo", "S. America", "SRD", -3], "sweden": ["Stockholm", "Europe", "SEK", 1],
        "switzerland": ["Bern", "Europe", "CHF", 1], "syria": ["Damascus", "Asia", "SYP", 3], "taiwan": ["Taipei", "Asia", "TWD", 8],
        "tajikistan": ["Dushanbe", "Asia", "TJS", 5], "tanzania": ["Dodoma", "Africa", "TZS", 3], "thailand": ["Bangkok", "Asia", "THB", 7],
        "togo": ["Lome", "Africa", "XOF", 0], "tonga": ["Nuku'alofa", "Oceania", "TOP", 13], "trinidad": ["Port of Spain", "N. America", "TTD", -4],
        "tunisia": ["Tunis", "Africa", "TND", 1], "turkey": ["Ankara", "Europe", "TRY", 3], "turkmenistan": ["Ashgabat", "Asia", "TMT", 5],
        "tuvalu": ["Funafuti", "Oceania", "AUD", 12], "uganda": ["Kampala", "Africa", "UGX", 3], "ukraine": ["Kyiv", "Europe", "UAH", 2],
        "uae": ["Abu Dhabi", "Asia", "AED", 4], "uk": ["London", "Europe", "GBP", 0], "usa": ["Washington D.C.", "N. America", "USD", -5],
        "uruguay": ["Montevideo", "S. America", "UYU", -3], "uzbekistan": ["Tashkent", "Asia", "UZS", 5], "vanuatu": ["Port Vila", "Oceania", "VUV", 11],
        "vatican": ["Vatican City", "Europe", "EUR", 1], "venezuela": ["Caracas", "S. America", "VES", -4], "vietnam": ["Hanoi", "Asia", "VND", 7],
        "yemen": ["Sanaa", "Asia", "YER", 3], "zambia": ["Lusaka", "Africa", "ZMW", 2], "zimbabwe": ["Harare", "Africa", "ZWL", 2],
        "niue": ["Alofi", "Oceania", "NZD", -11], "tokelau": ["Nukunonu", "Oceania", "NZD", 13], "greenland": ["Nuuk", "N. America", "DKK", -3]
    },
    
    calcTime(offset) {
        const d = new Date();
        const utc = d.getTime() + (d.getTimezoneOffset() * 60000);
        const nd = new Date(utc + (3600000 * offset));
        return nd.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
    },

    getDate(offset) {
        const d = new Date();
        const utc = d.getTime() + (d.getTimezoneOffset() * 60000);
        const nd = new Date(utc + (3600000 * offset));
        return nd.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
    }
};

const App = {
    isOnline: true,

    toggleMenu() {
        const s = document.getElementById('sidebar');
        const o = document.getElementById('overlay');
        const open = s.classList.toggle('open');
        o.style.display = open ? 'block' : 'none';
    },

    updateMode() {
        this.isOnline = document.getElementById('mode-toggle').checked;
        const b = document.getElementById('status-badge');
        b.innerText = this.isOnline ? "Online" : "Offline";
        b.className = `mode-badge ${this.isOnline ? 'mode-online' : 'mode-offline'}`;
    },
    
    // --- VOICE INPUT LOGIC ---
    startVoice() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert("Voice input is not supported in this browser.");
            return;
        }

        const recognition = new SpeechRecognition();
        const micBtn = document.getElementById('mic-btn');
        
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.onstart = () => {
            micBtn.classList.add('mic-active');
            document.getElementById('query').placeholder = "Listening...";
        };

        recognition.onend = () => {
            micBtn.classList.remove('mic-active');
            document.getElementById('query').placeholder = "Ask Askme";
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById('query').value = transcript;
            this.send(); // Auto send after speaking
        };

        recognition.start();
    },

    fill(t) { document.getElementById('query').value = t; this.send(); },
    
    async sync() { await puter.auth.signIn(); },

    addMsg(content, role) {
        document.getElementById('hero')?.remove();
        const m = document.getElementById('messages');
        const d = document.createElement('div');
        d.className = role === 'u' ? 'msg-u' : 'msg-ai';
        d.innerHTML = role === 'u' ? content : `<div class="ai-icon">A</div><div class="flex-1 prose">${marked.parse(content)}</div>`;
        m.appendChild(d);
        document.getElementById('chat-window').scrollTo(0, m.scrollHeight);
    },

    async send() {
        const inp = document.getElementById('query');
        const q = inp.value.trim(); if(!q) return;
        inp.value = "";
        this.addMsg(q, 'u');
        
        const l = q.toLowerCase();
        let res = "";
        let foundCountry = Object.keys(Atlas.db).find(k => l.includes(k));

        // 1. Math Check (Highest Priority Offline)
        if (/[0-9]/.test(q) && /[\+\-\*\/\^]/.test(l)) {
            try { res = `üî¢ **Calculated:** ${eval(l.replace(/x/g, '*').replace(/[^-()\d/*+.]/g, ''))}`; } 
            catch { res = "Math Error."; }
        }
        // 2. Atlas Check (Time/Date/Info)
        else if (foundCountry) {
            const data = Atlas.db[foundCountry];
            const time = Atlas.calcTime(data[3]);
            const date = Atlas.getDate(data[3]);
            
            res = `<div class="country-card">
                <div class="text-xl font-bold capitalize text-blue-800 mb-1">üìç ${foundCountry.toUpperCase()}</div>
                <div class="text-sm text-gray-500 mb-4">${data[0]} ‚Ä¢ ${data[1]}</div>
                <div class="time-display">${time}</div>
                <div class="text-md font-medium text-gray-700">${date}</div>
                <div class="mt-4 pt-3 border-t flex gap-4 text-sm text-gray-600">
                    <span>üí∞ Currency: <b>${data[2]}</b></span>
                    <span>üåê UTC: <b>${data[3] > 0 ? '+' : ''}${data[3]}</b></span>
                </div>
            </div>`;
        }
        // 3. Online AI
        else if (this.isOnline) {
            if(puter.auth.isSignedIn()) res = (await puter.ai.chat(q)).toString();
            else res = "‚òÅÔ∏è **Online Mode Active:** Please Sync Profile to use Cloud AI.";
        }
        // 4. Offline Fallback
        else {
            res = "üìµ **Offline:** I don't see that country in my database. Try 'USA', 'Dhaka', or 'Kiribati'. Switch to Online for more.";
        }

        setTimeout(() => this.addMsg(res, 'ai'), 500);
    }
};

document.getElementById('send-trigger').onclick = () => App.send();
document.getElementById('query').addEventListener('keypress', (e) => { if(e.key === 'Enter') App.send(); });
</script>
</body>
</html>
