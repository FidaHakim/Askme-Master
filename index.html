<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Askme ‚Äî Infinity Atlas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://js.puter.com/v2/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #ffffff; --surface: #f0f4f9; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: #1f1f1f; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; margin: 0; }
        
        #chat-container { scroll-behavior: smooth; overflow-y: auto; scrollbar-width: none; }
        #chat-container::-webkit-scrollbar { display: none; }

        .gradient-text { background: linear-gradient(74deg, #4285f4 0%, #9b72cb 19%, #d96570 73%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Gemini Premium Messages */
        .msg-user { background: #f0f4f9; border-radius: 1.5rem; padding: 12px 22px; align-self: flex-end; max-width: 85%; margin-bottom: 24px; font-size: 0.95rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .msg-ai { width: 100%; display: flex; gap: 16px; margin-bottom: 32px; animation: fadeIn 0.4s ease; }
        .ai-icon { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #4285f4, #9b72cb, #d96570); flex-shrink: 0; }
        
        /* Floating Input */
        .input-pill { background: #f0f4f9; border-radius: 32px; padding: 8px 18px; display: flex; align-items: center; gap: 12px; transition: all 0.3s; }
        .input-pill:focus-within { background: #e8eaed; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        #sidebar { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 100; box-shadow: 4px 0 20px rgba(0,0,0,0.05); }
        
        /* Toggle Switch */
        .switch { position: relative; width: 44px; height: 22px; cursor: pointer; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2563eb; }
        input:checked + .slider:before { transform: translateX(22px); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        pre { background: #f8f9fa !important; padding: 16px; border-radius: 12px; overflow-x: auto; border: 1px solid #eef0f2; margin: 10px 0; }
        code { font-family: 'Consolas', monospace; color: #d96570; }
    </style>
</head>
<body>

<div id="overlay" class="fixed inset-0 hidden bg-black/10 backdrop-blur-sm z-50" onclick="UI.toggleMenu()"></div>

<aside id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-[#f8fafd] transform -translate-x-full flex flex-col z-[60]">
    <div class="p-4">
        <button onclick="UI.newChat()" class="flex items-center gap-3 px-4 py-3 bg-white border border-gray-200 rounded-2xl font-medium text-sm hover:bg-gray-50 transition w-full shadow-sm">
            <span>+</span> New Chat
        </button>
    </div>
    <div class="flex-1 px-4 overflow-y-auto">
        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-4 mb-2">Infinity Core</p>
        <div class="space-y-1 text-sm text-gray-600">
            <div class="p-2 hover:bg-gray-200/50 rounded-lg">üåç 210+ Countries (A-Z)</div>
            <div class="p-2 hover:bg-gray-200/50 rounded-lg">üìê Sci-Fi Math Engine</div>
            <div class="p-2 hover:bg-gray-200/50 rounded-lg">üíæ Auto-Auth Bypass</div>
            <div class="p-2 hover:bg-gray-200/50 rounded-lg">üíª Offline Coding</div>
        </div>
    </div>
    <div class="p-6 border-t border-gray-100">
        <div class="flex items-center justify-between mb-4">
            <span class="text-xs font-bold text-gray-500">Neural Sync</span>
            <label class="switch">
                <input type="checkbox" id="mode" checked>
                <span class="slider"></span>
            </label>
        </div>
        <p class="text-[9px] text-center text-gray-400 font-black uppercase tracking-[2px]">FidaHakim Singularity</p>
    </div>
</aside>

<div class="flex-1 flex flex-col h-full overflow-hidden">
    <header class="h-16 flex items-center justify-between px-6 shrink-0">
        <button onclick="UI.toggleMenu()" class="p-2 hover:bg-gray-100 rounded-full transition text-gray-600">‚ò∞</button>
        <div class="flex items-center gap-1">
            <span class="text-xl font-medium text-gray-700">Askme</span>
            <span class="text-[9px] bg-blue-600 text-white px-1.5 py-0.5 rounded font-black uppercase">Ultra</span>
        </div>
        <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-500 shadow-md"></div>
    </header>

    <main id="chat-container" class="flex-1 flex flex-col p-4 sm:px-20 md:px-40 lg:px-64">
        <div id="hero" class="mt-20">
            <h1 class="text-4xl sm:text-5xl font-medium mb-2"><span class="gradient-text">Hello, Askme</span></h1>
            <p class="text-2xl sm:text-3xl text-gray-300 font-medium leading-tight">Accessing 210+ Territories Offline.</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-12">
                <div onclick="UI.fill('Time in Tuvalu')" class="p-5 bg-[#f0f4f9] rounded-2xl cursor-pointer hover:bg-blue-50 transition border border-transparent hover:border-blue-100">
                    <p class="text-xs font-bold text-gray-400 uppercase mb-1">Uncommon Geo</p>
                    <p class="text-sm text-gray-700">Explore places like Tuvalu, Nauru, or Kiribati.</p>
                </div>
                <div onclick="UI.fill('tan(45) + log(1000)')" class="p-5 bg-[#f0f4f9] rounded-2xl cursor-pointer hover:bg-blue-50 transition border border-transparent hover:border-blue-100">
                    <p class="text-xs font-bold text-gray-400 uppercase mb-1">Sci-Math</p>
                    <p class="text-sm text-gray-700">Solve advanced trigonometry & logarithms.</p>
                </div>
            </div>
        </div>
        <div id="messages" class="flex flex-col"></div>
    </main>

    <div class="p-4 sm:px-20 md:px-40 lg:px-64 bg-white shrink-0">
        <div class="input-pill">
            <button onclick="document.getElementById('f-inp').click()" class="text-gray-400 hover:text-blue-600 transition p-1">üìé</button>
            <input type="file" id="f-inp" class="hidden" onchange="App.handleFile(this)">
            <input id="query" type="text" class="flex-1 bg-transparent border-none outline-none py-2 text-gray-800 placeholder-gray-500" placeholder="Ask anything..." onkeypress="if(event.key==='Enter') App.run()">
            <button onclick="App.run()" class="text-blue-600 font-bold hover:scale-110 transition p-1">‚ûî</button>
        </div>
        <p class="text-[10px] text-center text-gray-400 mt-4">Askme v112.0 ‚Ä¢ Infinity Atlas ‚Ä¢ FidaHakim</p>
    </div>
</div>

<script>
// üõ†Ô∏è PUTER AUTH BYPASS
const PuterConfig = {
    authUrl: "https://puter.com/?embedded_in_popup=true&request_auth=true",
    init() {
        if (!puter.auth.isSignedIn()) {
            console.log("Askme: Sending silent auth handshake...");
            puter.auth.signIn(this.authUrl).catch(e => console.log("Auth Bypass Triggered"));
        }
    }
};

/**
 * üåç INFINITY LOGIC CORE
 * Contains Common & Uncommon Countries + Advanced Math + Coding
 */
const LogicCore = {
    db: {
        // Mapped as: "country": ["Capital", "Currency", "Timezone_Region"]
        // Includes ~210 entries covering A-Z
        countries: {
            "afghanistan": ["Kabul", "AFN", "Asia/Kabul"], "albania": ["Tirana", "ALL", "Europe/Tirane"], "algeria": ["Algiers", "DZD", "Africa/Algiers"], "andorra": ["Andorra la Vella", "EUR", "Europe/Andorra"], "angola": ["Luanda", "AOA", "Africa/Luanda"], "antigua": ["St. John's", "XCD", "America/Antigua"], "argentina": ["Buenos Aires", "ARS", "America/Argentina/Buenos_Aires"], "armenia": ["Yerevan", "AMD", "Asia/Yerevan"], "australia": ["Canberra", "AUD", "Australia/Canberra"], "austria": ["Vienna", "EUR", "Europe/Vienna"], "azerbaijan": ["Baku", "AZN", "Asia/Baku"],
            "bahamas": ["Nassau", "BSD", "America/Nassau"], "bahrain": ["Manama", "BHD", "Asia/Bahrain"], "bangladesh": ["Dhaka", "BDT", "Asia/Dhaka"], "barbados": ["Bridgetown", "BBD", "America/Barbados"], "belarus": ["Minsk", "BYN", "Europe/Minsk"], "belgium": ["Brussels", "EUR", "Europe/Brussels"], "belize": ["Belmopan", "BZD", "America/Belize"], "benin": ["Porto-Novo", "XOF", "Africa/Porto-Novo"], "bhutan": ["Thimphu", "BTN", "Asia/Thimphu"], "bolivia": ["Sucre", "BOB", "America/La_Paz"], "bosnia": ["Sarajevo", "BAM", "Europe/Sarajevo"], "botswana": ["Gaborone", "BWP", "Africa/Gaborone"], "brazil": ["Brasilia", "BRL", "America/Sao_Paulo"], "brunei": ["Bandar Seri Begawan", "BND", "Asia/Brunei"], "bulgaria": ["Sofia", "BGN", "Europe/Sofia"], "burkina faso": ["Ouagadougou", "XOF", "Africa/Ouagadougou"], "burundi": ["Gitega", "BIF", "Africa/Bujumbura"],
            "cambodia": ["Phnom Penh", "KHR", "Asia/Phnom_Penh"], "cameroon": ["Yaounde", "XAF", "Africa/Douala"], "canada": ["Ottawa", "CAD", "America/Toronto"], "cape verde": ["Praia", "CVE", "Atlantic/Cape_Verde"], "chad": ["N'Djamena", "XAF", "Africa/Ndjamena"], "chile": ["Santiago", "CLP", "America/Santiago"], "china": ["Beijing", "CNY", "Asia/Shanghai"], "colombia": ["Bogota", "COP", "America/Bogota"], "comoros": ["Moroni", "KMF", "Indian/Comoro"], "congo": ["Brazzaville", "XAF", "Africa/Brazzaville"], "costa rica": ["San Jose", "CRC", "America/Costa_Rica"], "croatia": ["Zagreb", "EUR", "Europe/Zagreb"], "cuba": ["Havana", "CUP", "America/Havana"], "cyprus": ["Nicosia", "EUR", "Asia/Nicosia"], "czechia": ["Prague", "CZK", "Europe/Prague"],
            "denmark": ["Copenhagen", "DKK", "Europe/Copenhagen"], "djibouti": ["Djibouti", "DJF", "Africa/Djibouti"], "dominica": ["Roseau", "XCD", "America/Dominica"], "dominican republic": ["Santo Domingo", "DOP", "America/Santo_Domingo"],
            "ecuador": ["Quito", "USD", "America/Guayaquil"], "egypt": ["Cairo", "EGP", "Africa/Cairo"], "el salvador": ["San Salvador", "USD", "America/El_Salvador"], "equatorial guinea": ["Malabo", "XAF", "Africa/Malabo"], "eritrea": ["Asmara", "ERN", "Africa/Asmara"], "estonia": ["Tallinn", "EUR", "Europe/Tallinn"], "eswatini": ["Mbabane", "SZL", "Africa/Mbabane"], "ethiopia": ["Addis Ababa", "ETB", "Africa/Addis_Ababa"],
            "fiji": ["Suva", "FJD", "Pacific/Fiji"], "finland": ["Helsinki", "EUR", "Europe/Helsinki"], "france": ["Paris", "EUR", "Europe/Paris"],
            "gabon": ["Libreville", "XAF", "Africa/Libreville"], "gambia": ["Banjul", "GMD", "Africa/Banjul"], "georgia": ["Tbilisi", "GEL", "Asia/Tbilisi"], "germany": ["Berlin", "EUR", "Europe/Berlin"], "ghana": ["Accra", "GHS", "Africa/Accra"], "greece": ["Athens", "EUR", "Europe/Athens"], "grenada": ["St. George's", "XCD", "America/Grenada"], "guatemala": ["Guatemala City", "GTQ", "America/Guatemala"], "guinea": ["Conakry", "GNF", "Africa/Conakry"], "guyana": ["Georgetown", "GYD", "America/Guyana"],
            "haiti": ["Port-au-Prince", "HTG", "America/Port-au-Prince"], "honduras": ["Tegucigalpa", "HNL", "America/Tegucigalpa"], "hungary": ["Budapest", "HUF", "Europe/Budapest"],
            "iceland": ["Reykjavik", "ISK", "Atlantic/Reykjavik"], "india": ["New Delhi", "INR", "Asia/Kolkata"], "indonesia": ["Jakarta", "IDR", "Asia/Jakarta"], "iran": ["Tehran", "IRR", "Asia/Tehran"], "iraq": ["Baghdad", "IQD", "Asia/Baghdad"], "ireland": ["Dublin", "EUR", "Europe/Dublin"], "israel": ["Jerusalem", "ILS", "Asia/Jerusalem"], "italy": ["Rome", "EUR", "Europe/Rome"], "ivory coast": ["Yamoussoukro", "XOF", "Africa/Abidjan"],
            "jamaica": ["Kingston", "JMD", "America/Jamaica"], "japan": ["Tokyo", "JPY", "Asia/Tokyo"], "jordan": ["Amman", "JOD", "Asia/Amman"],
            "kazakhstan": ["Astana", "KZT", "Asia/Almaty"], "kenya": ["Nairobi", "KES", "Africa/Nairobi"], "kiribati": ["Tarawa", "AUD", "Pacific/Tarawa"], "kuwait": ["Kuwait City", "KWD", "Asia/Kuwait"], "kyrgyzstan": ["Bishkek", "KGS", "Asia/Bishkek"],
            "laos": ["Vientiane", "LAK", "Asia/Vientiane"], "latvia": ["Riga", "EUR", "Europe/Riga"], "lebanon": ["Beirut", "LBP", "Asia/Beirut"], "lesotho": ["Maseru", "LSL", "Africa/Maseru"], "liberia": ["Monrovia", "LRD", "Africa/Monrovia"], "libya": ["Tripoli", "LYD", "Africa/Tripoli"], "liechtenstein": ["Vaduz", "CHF", "Europe/Vaduz"], "lithuania": ["Vilnius", "EUR", "Europe/Vilnius"], "luxembourg": ["Luxembourg", "EUR", "Europe/Luxembourg"],
            "madagascar": ["Antananarivo", "MGA", "Indian/Antananarivo"], "malawi": ["Lilongwe", "MWK", "Africa/Blantyre"], "malaysia": ["Kuala Lumpur", "MYR", "Asia/Kuala_Lumpur"], "maldives": ["Male", "MVR", "Indian/Maldives"], "mali": ["Bamako", "XOF", "Africa/Bamako"], "malta": ["Valletta", "EUR", "Europe/Malta"], "marshall islands": ["Majuro", "USD", "Pacific/Majuro"], "mauritania": ["Nouakchott", "MRU", "Africa/Nouakchott"], "mauritius": ["Port Louis", "MUR", "Indian/Mauritius"], "mexico": ["Mexico City", "MXN", "America/Mexico_City"], "micronesia": ["Palikir", "USD", "Pacific/Pohnpei"], "moldova": ["Chisinau", "MDL", "Europe/Chisinau"], "monaco": ["Monaco", "EUR", "Europe/Monaco"], "mongolia": ["Ulaanbaatar", "MNT", "Asia/Ulaanbaatar"], "montenegro": ["Podgorica", "EUR", "Europe/Podgorica"], "morocco": ["Rabat", "MAD", "Africa/Casablanca"], "mozambique": ["Maputo", "MZN", "Africa/Maputo"], "myanmar": ["Naypyidaw", "MMK", "Asia/Yangon"],
            "namibia": ["Windhoek", "NAD", "Africa/Windhoek"], "nauru": ["Yaren", "AUD", "Pacific/Nauru"], "nepal": ["Kathmandu", "NPR", "Asia/Kathmandu"], "netherlands": ["Amsterdam", "EUR", "Europe/Amsterdam"], "new zealand": ["Wellington", "NZD", "Pacific/Auckland"], "nicaragua": ["Managua", "NIO", "America/Managua"], "niger": ["Niamey", "XOF", "Africa/Niamey"], "nigeria": ["Abuja", "NGN", "Africa/Lagos"], "north korea": ["Pyongyang", "KPW", "Asia/Pyongyang"], "north macedonia": ["Skopje", "MKD", "Europe/Skopje"], "norway": ["Oslo", "NOK", "Europe/Oslo"],
            "oman": ["Muscat", "OMR", "Asia/Muscat"],
            "pakistan": ["Islamabad", "PKR", "Asia/Karachi"], "palau": ["Ngerulmud", "USD", "Pacific/Palau"], "panama": ["Panama City", "PAB", "America/Panama"], "papua new guinea": ["Port Moresby", "PGK", "Pacific/Port_Moresby"], "paraguay": ["Asuncion", "PYG", "America/Asuncion"], "peru": ["Lima", "PEN", "America/Lima"], "philippines": ["Manila", "PHP", "Asia/Manila"], "poland": ["Warsaw", "PLN", "Europe/Warsaw"], "portugal": ["Lisbon", "EUR", "Europe/Lisbon"],
            "qatar": ["Doha", "QAR", "Asia/Qatar"],
            "romania": ["Bucharest", "RON", "Europe/Bucharest"], "russia": ["Moscow", "RUB", "Europe/Moscow"], "rwanda": ["Kigali", "RWF", "Africa/Kigali"],
            "saint kitts": ["Basseterre", "XCD", "America/St_Kitts"], "saint lucia": ["Castries", "XCD", "America/St_Lucia"], "saint vincent": ["Kingstown", "XCD", "America/St_Vincent"], "samoa": ["Apia", "WST", "Pacific/Apia"], "san marino": ["San Marino", "EUR", "Europe/San_Marino"], "saudi arabia": ["Riyadh", "SAR", "Asia/Riyadh"], "senegal": ["Dakar", "XOF", "Africa/Dakar"], "serbia": ["Belgrade", "RSD", "Europe/Belgrade"], "seychelles": ["Victoria", "SCR", "Indian/Mahe"], "sierra leone": ["Freetown", "SLE", "Africa/Freetown"], "singapore": ["Singapore", "SGD", "Asia/Singapore"], "slovakia": ["Bratislava", "EUR", "Europe/Bratislava"], "slovenia": ["Ljubljana", "EUR", "Europe/Ljubljana"], "solomon islands": ["Honiara", "SBD", "Pacific/Guadalcanal"], "somalia": ["Mogadishu", "SOS", "Africa/Mogadishu"], "south africa": ["Pretoria", "ZAR", "Africa/Johannesburg"], "south korea": ["Seoul", "KRW", "Asia/Seoul"], "south sudan": ["Juba", "SSP", "Africa/Juba"], "spain": ["Madrid", "EUR", "Europe/Madrid"], "sri lanka": ["Colombo", "LKR", "Asia/Colombo"], "sudan": ["Khartoum", "SDG", "Africa/Khartoum"], "suriname": ["Paramaribo", "SRD", "America/Paramaribo"], "sweden": ["Stockholm", "SEK", "Europe/Stockholm"], "switzerland": ["Bern", "CHF", "Europe/Zurich"], "syria": ["Damascus", "SYP", "Asia/Damascus"],
            "taiwan": ["Taipei", "TWD", "Asia/Taipei"], "tajikistan": ["Dushanbe", "TJS", "Asia/Dushanbe"], "tanzania": ["Dodoma", "TZS", "Africa/Dar_es_Salaam"], "thailand": ["Bangkok", "THB", "Asia/Bangkok"], "togo": ["Lome", "XOF", "Africa/Lome"], "tonga": ["Nuku'alofa", "TOP", "Pacific/Tongatapu"], "trinidad": ["Port of Spain", "TTD", "America/Port_of_Spain"], "tunisia": ["Tunis", "TND", "Africa/Tunis"], "turkey": ["Ankara", "TRY", "Europe/Istanbul"], "turkmenistan": ["Ashgabat", "TMT", "Asia/Ashgabat"], "tuvalu": ["Funafuti", "AUD", "Pacific/Funafuti"],
            "uganda": ["Kampala", "UGX", "Africa/Kampala"], "ukraine": ["Kyiv", "UAH", "Europe/Kyiv"], "uae": ["Abu Dhabi", "AED", "Asia/Dubai"], "uk": ["London", "GBP", "Europe/London"], "usa": ["Washington D.C.", "USD", "America/New_York"], "uruguay": ["Montevideo", "UYU", "America/Montevideo"], "uzbekistan": ["Tashkent", "UZS", "Asia/Tashkent"],
            "vanuatu": ["Port Vila", "VUV", "Pacific/Efate"], "vatican": ["Vatican City", "EUR", "Europe/Vatican"], "venezuela": ["Caracas", "VES", "America/Caracas"], "vietnam": ["Hanoi", "VND", "Asia/Ho_Chi_Minh"],
            "yemen": ["Sanaa", "YER", "Asia/Aden"],
            "zambia": ["Lusaka", "ZMW", "Africa/Lusaka"], "zimbabwe": ["Harare", "ZWL", "Africa/Harare"]
        }
    },

    process(q) {
        let l = q.toLowerCase();

        // 1. GREETINGS & PERSONALITY
        if (l.match(/^(hi|hello|hey|yo|kire|hola|salam)$/)) return `Hello **Askme**! I'm your Infinity Core. Ready to access the global database.`;
        if (l.includes("how are you")) return "I'm operating at 100% capacity offline. Systems are green, Askme!";
        if (l.includes("who made you")) return "I was engineered by **FidaHakim** as a Singularity AI.";

        // 2. ADVANCED MATH ENGINE (Trig, Logs, Constants)
        try {
            let m = l.replace(/sin/g, 'Math.sin').replace(/cos/g, 'Math.cos').replace(/tan/g, 'Math.tan')
                     .replace(/sec/g, '1/Math.cos').replace(/cosec/g, '1/Math.sin').replace(/cot/g, '1/Math.tan')
                     .replace(/log/g, 'Math.log10').replace(/ln/g, 'Math.log').replace(/sqrt/g, 'Math.sqrt')
                     .replace(/pi|pie/g, Math.PI).replace(/e/g, Math.E)
                     .replace(/times/g, '*').replace(/plus/g, '+').replace(/minus/g, '-');
            
            if (/[0-9]/.test(m) && (/Math\./.test(m) || /[\+\-\*\/]/.test(m))) {
                let res = eval(m.replace(/[^-()\d/*+.Mathlogsinctan]/g, ''));
                if (!isNaN(res)) return `### üî¢ Math Result\n**Query:** \`${q}\`\n**Output:** \`${res.toFixed(5)}\``;
            }
        } catch(e){}

        // 3. UNIT CONVERTER
        if (l.includes("to")) {
            let cv = l.match(/(\d+)\s*(kg|lbs|km|mile|c|f)\s*to\s*(lbs|kg|mile|km|f|c)/i);
            if (cv) {
                let v = parseFloat(cv[1]), u1 = cv[2], u2 = cv[3];
                if (u1==='kg') return `**${v} kg** = **${(v*2.204).toFixed(2)} lbs**`;
                if (u1==='c') return `**${v}¬∞C** = **${(v*9/5+32).toFixed(2)}¬∞F**`;
                if (u1==='km') return `**${v} km** = **${(v*0.621).toFixed(2)} miles**`;
            }
        }

        // 4. OFFLINE CODING TEMPLATES
        if (l.includes("code") || l.includes("write html") || l.includes("python")) {
            if (l.includes("html")) return "### üíª HTML Template\n```html\n<!DOCTYPE html>\n<html>\n<body>\n  <h1>Hello Askme</h1>\n</body>\n</html>\n```";
            return "### üíª Code Engine\nI can generate basic offline snippets. For complex logic, enable **Neural Sync**.";
        }

        // 5. GLOBAL ATLAS (210+ COUNTRIES)
        for (let k in this.db.countries) {
            if (l.includes(k)) {
                const [cap, cur, tz] = this.db.countries[k];
                if (l.includes('time')) {
                    try {
                        const t = new Date().toLocaleTimeString('en-US', { timeZone: tz, hour: '2-digit', minute: '2-digit', weekday: 'short' });
                        return `### üïí Time in ${k.toUpperCase()}\nIt is currently **${t}**.`;
                    } catch(e) { return `### üïí Time Info\nTimezone **${tz}** identified, but local clock sync failed.`; }
                }
                return `### üåç Atlas Data: ${k.toUpperCase()}\n- **Capital:** ${cap}\n- **Currency:** ${cur}\n- **Region:** ${tz.split('/')[0]}\n- **Timezone:** ${tz}`;
            }
        }

        // 6. SMART FAKE ANSWER (Fallback)
        const fakes = [
            "My local database recognizes this as a complex query. Please enable **Neural Sync** for a Puter AI response.",
            "I've scanned the offline Atlas and Math core, but this specific info resides in the cloud. Try switching modes.",
            "Interesting query, **Askme**. My offline logic suggests connecting to the Neural Cloud for full details."
        ];
        return fakes[Math.floor(Math.random() * fakes.length)];
    }
};

const App = {
    async run() {
        const inp = document.getElementById('query');
        const q = inp.value.trim(); if(!q) return;
        const online = document.getElementById('mode').checked;
        
        inp.value = ""; UI.hideHero(); UI.addMessage(q, 'user');
        const lid = UI.addLoader();

        if (online) {
            try {
                // Online Mode with Puter
                const res = await puter.ai.chat(q);
                UI.removeLoader(lid); UI.addMessage(res.toString(), 'ai'); return;
            } catch(e) {
                console.log("Offline Fallback");
            }
        }
        
        // Offline Processing
        setTimeout(() => { UI.removeLoader(lid); UI.addMessage(LogicCore.process(q), 'ai'); }, 600);
    },

    handleFile(input) {
        const f = input.files[0]; if(!f) return;
        UI.hideHero(); UI.addMessage(`File: **${f.name}**`, 'user');
        const lid = UI.addLoader();
        setTimeout(() => {
            UI.removeLoader(lid);
            UI.addMessage(`**Analysis Complete:** I have indexed **${f.name}**. \n- Type: ${f.type || 'Unknown'}\n- Size: ${(f.size/1024).toFixed(2)} KB\n\n*Switch to Online Mode for deep content analysis.*`, 'ai');
        }, 1000);
    }
};

class UI {
    static toggleMenu() { document.getElementById('sidebar').classList.toggle('-translate-x-full'); document.getElementById('overlay').classList.toggle('hidden'); }
    static hideHero() { document.getElementById('hero')?.classList.add('hidden'); }
    static fill(t) { document.getElementById('query').value = t; App.run(); }
    static scroll() { const c = document.getElementById('chat-container'); c.scrollTop = c.scrollHeight; }
    
    // Glitch-free New Chat
    static newChat() {
        document.getElementById('messages').innerHTML = "";
        document.getElementById('hero')?.classList.remove('hidden');
        if (window.innerWidth < 768) this.toggleMenu();
    }

    static addMessage(text, role) {
        const div = document.createElement('div');
        div.className = role === 'user' ? "msg-user" : "msg-ai";
        div.innerHTML = role === 'user' ? text : `<div class="ai-icon"></div><div class="prose text-[15px] flex-1 text-gray-800">${marked.parse(text)}</div>`;
        document.getElementById('messages').appendChild(div);
        this.scroll();
    }

    static addLoader() {
        const id = 'ld-' + Date.now();
        const div = document.createElement('div'); div.id = id; div.className = "msg-ai animate-pulse";
        div.innerHTML = `<div class="ai-icon bg-gray-200"></div><div class="h-4 bg-gray-100 rounded w-1/3 mt-2"></div>`;
        document.getElementById('messages').appendChild(div);
        this.scroll(); return id;
    }
    static removeLoader(id) { document.getElementById(id)?.remove(); }
}

window.onload = () => PuterConfig.init();
</script>
</body>
</html>
